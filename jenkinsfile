pipeline{
agent any 
    stages {
    stage('Cloning')
    {
    steps
    {
    sh'git clone https://github.com/aishwaryashinde00/go-web.git'
   sh'cd go-web' }
     }
            stage('Build')
    {
        steps {
    sh'WEB_IMAGE_NAME="aishwaryashinde/go-web:kube${BUILD_NUMBER}"'
 sh'docker build -t aishwaryashinde/go-web:${BUILD_NUMBER} .'
sh 'docker login -u aishwaryashinde -p ${DOCKER_HUB}'
sh 'docker push aishwaryashinde/go-web:${BUILD_NUMBER} '     
}  
   
   }
   
    stage('Deployment')
    {
        steps {
           sh 'WEB_IMAGE_NAME="aishwaryashinde/go-web:kube${BUILD_NUMBER}"'
           sh ' create -f ${WORKSPACE}/go-web.yaml || true'
sh 'kubectl set image deployment/go-web go-web=aishwaryashinde/go-web:${BUILD_NUMBER} --kubeconfig /var/lib/jenkins/.kube/config'
             }
    }
}
}
